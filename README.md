# Приложение для Обнаружения Телефонов

Настольное приложение для обнаружения телефонов в режиме реального времени с использованием компьютерного зрения и машинного обучения. Приложение может обнаруживать телефоны в потоке с камеры, используя либо API Roboflow, либо локальную модель YOLOv8.

## Возможности

- **Обнаружение в реальном времени**: Непрерывное обнаружение телефонов с веб-камеры или IP-камеры
- **Два режима работы**:
  - **Режим API**: Использует облачную модель Roboflow (требуется интернет)
  - **Локальный режим**: Использует локальную модель YOLOv8 (интернет не требуется)
- **Снимок и анализ**: Захват и анализ отдельных кадров
- **Визуальная обратная связь**: Отображение ограничивающих рамок и показателей уверенности в реальном времени
- **Сохранение скриншотов**: Сохранение обнаруженных кадров с аннотациями
- **Счетчик FPS**: Мониторинг производительности видеопотока
- **Поддержка IP-камер**: Подключение к сетевым камерам (IP Webcam, DroidCam и др.)
- **Удобный GUI**: Создан с помощью Tkinter для простого взаимодействия

## Сценарии использования

- Мониторинг использования телефонов в учебных аудиториях
- Проверка соблюдения правил на рабочих местах
- Приложения для безопасности
- Исследования и разработка в области обнаружения объектов
- Образовательные цели в области компьютерного зрения

## Быстрый старт

### Требования

- Python 3.8 или выше
- Веб-камера или IP-камера
- Интернет-соединение (для режима API или начальной настройки)

### Установка

1. **Клонируйте репозиторий**
   ```bash
   git clone https://github.com/Michael-merlot/ProjectPracticumBVT2201.git
   cd phone-detection-app
   ```

2. **Установите зависимости**
   ```bash
   pip install -r requirements.txt
   ```

3. **Настройте окружение**
   - Скопируйте `.env.example` в `.env`
   - Отредактируйте `.env` с вашими настройками:
   ```bash
   cp .env.example .env
   ```

### Варианты конфигурации

#### Вариант 1: Режим API (Roboflow Cloud)

Отредактируйте файл `.env`:
```env
# Использовать Roboflow API
USE_LOCAL_MODEL=false
ROBOFLOW_API_KEY=ваш_api_ключ_здесь
ROBOFLOW_WORKSPACE=phone-in-hand-detection
ROBOFLOW_PROJECT=phone-in-hand-detection
ROBOFLOW_VERSION=19

# Источник камеры (0 для веб-камеры по умолчанию)
CAMERA_SOURCE=0
```

**Как получить API ключ:**
1. Зарегистрируйтесь на https://roboflow.com
2. Перейдите в Settings → API
3. Скопируйте ваш API ключ

#### Вариант 2: Локальный режим (без интернета)

Отредактируйте файл `.env`:
```env
# Использовать локальную модель
USE_LOCAL_MODEL=true
LOCAL_MODEL_PATH=models/best.pt

# API ключ не требуется в локальном режиме
CAMERA_SOURCE=0
```

**Загрузка и обучение локальной модели:**

**Вариант A: Загрузить датасет и обучить модель (рекомендуется)**
```bash
python scripts/download_and_train_v32.py
```
Этот скрипт:
- Загружает датасет версии 32 с Roboflow
- Обучает модель YOLOv8 на этом датасете
- Сохраняет обученную модель в `models/best.pt`
- Время обучения: 30-60 минут (зависит от оборудования)

**Вариант B: Только загрузить датасет (для ручного обучения)**
```bash
python scripts/download_dataset_v32.py
```

**Вариант C: Использовать стандартную модель YOLOv8**
```bash
python scripts/download_yolo_simple.py
```
Примечание: Эта модель менее точная для обнаружения "телефон в руке"

### Запуск приложения

#### Windows:
```bash
run.bat
```
или
```bash
python desktop_app/main.py
```

#### Linux/Mac:
```bash
chmod +x run.sh
./run.sh
```
или
```bash
python desktop_app/main.py
```

## Настройка источника камеры

### Локальная веб-камера
```env
CAMERA_SOURCE=0  # Камера по умолчанию
CAMERA_SOURCE=1  # Вторая камера
```

### IP-камера (Android)

**Используя IP Webcam:**
1. Установите приложение "IP Webcam" на Android
2. Запустите сервер в приложении
3. Используйте URL в `.env`:
```env
CAMERA_SOURCE=http://192.168.1.100:8080/video
```

**Используя DroidCam:**
1. Установите DroidCam на Android и ПК
2. Используйте URL в `.env`:
```env
CAMERA_SOURCE=http://192.168.1.100:4747/video
```

## Использование приложения

1. **Запустите приложение**
   - Подождите, пока модель загрузится (отображается статус)

2. **Начните обнаружение**
   - Нажмите "Start Camera" для запуска видеопотока
   - Камера начнет показывать изображение в реальном времени

3. **Сделайте снимок и обнаружьте телефон**
   - Нажмите "Take Snapshot & Detect"
   - Приложение проанализирует текущий кадр
   - Результаты отобразятся с ограничивающими рамками

4. **Сохраните результаты**
   - Нажмите "Save Screenshot" для сохранения кадра с обнаружениями
   - Файлы сохраняются в папке `screenshots/`

5. **Очистите результаты**
   - Нажмите "Clear Results" для удаления обнаружений и повторной попытки

6. **Остановите камеру**
   - Нажмите "Stop Camera" когда закончите

## Информация о статусе

Приложение отображает следующую информацию:

- **Result**: Обнаружен телефон или нет
- **Confidence**: Уровень уверенности обнаружения (0-100%)
- **Inference Time**: Время обработки кадра
- **Video FPS**: Частота кадров видеопотока
- **Status**: Текущий статус обработки

## Структура проекта

```
phone-detection-app/
├── config/                 # Конфигурационные файлы
│   ├── __init__.py
│   └── config.py          # Настройки приложения
├── src/                   # Исходный код
│   ├── __init__.py
│   ├── camera.py         # Управление камерой
│   ├── model.py          # Модели обнаружения (API и локальная)
│   └── gui.py            # Графический интерфейс
├── scripts/              # Вспомогательные скрипты
│   ├── download_model.py
│   ├── download_and_train_v32.py
│   ├── download_dataset_v32.py
│   └── download_yolo_simple.py
├── desktop_app/          # Точка входа приложения
│   └── main.py
├── screenshots/          # Сохраненные скриншоты (создается автоматически)
├── models/              # Файлы моделей (создается при загрузке)
├── requirements.txt     # Зависимости Python
├── .env.example        # Пример конфигурации
├── run.bat            # Скрипт запуска для Windows
└── run.sh             # Скрипт запуска для Linux/Mac
```

## Настройка параметров

В файле `config/config.py` можно изменить:

```python
# Пороги обнаружения
CONFIDENCE_THRESHOLD = 0.4  # Минимальная уверенность (0.0 - 1.0)
OVERLAP_THRESHOLD = 0.3     # Порог перекрытия для NMS

# Настройки камеры
CAMERA_WIDTH = 640
CAMERA_HEIGHT = 480
CAMERA_FPS = 30

# Настройки интерфейса
VIDEO_UPDATE_INTERVAL = 30  # мс между обновлениями видео
```

## Устранение неполадок

### Камера не запускается

**Проблема:** "Failed to start camera"

**Решение:**
- Проверьте, что камера подключена и не используется другим приложением
- Попробуйте другой индекс камеры: `CAMERA_SOURCE=1`
- Проверьте права доступа к камере
- Для IP-камеры: убедитесь, что URL правильный и камера доступна в сети

### Модель не загружается

**Проблема API режима:** "Failed to load model"

**Решение:**
- Проверьте ваш API ключ в `.env`
- Убедитесь, что у вас есть интернет-соединение
- Проверьте, что workspace/project/version правильные

**Проблема локального режима:** "Model file not found"

**Решение:**
- Убедитесь, что `USE_LOCAL_MODEL=true` в `.env`
- Загрузите модель: `python scripts/download_and_train_v32.py`
- Проверьте путь: `LOCAL_MODEL_PATH=models/best.pt`

### Низкая производительность

**Решение:**
- Используйте локальную модель вместо API
- Уменьшите разрешение камеры в `config.py`
- Увеличьте `VIDEO_UPDATE_INTERVAL`
- Используйте GPU (если доступен) для локальной модели

### Ошибки установки

**Проблема:** Ошибки при установке зависимостей

**Решение:**
```bash
# Обновите pip
python -m pip install --upgrade pip

# Установите зависимости по одной
pip install opencv-python
pip install roboflow
pip install ultralytics
pip install python-dotenv
```

## Зависимости

Основные библиотеки:

- **opencv-python** (>=4.8.0): Захват и обработка видео
- **roboflow** (>=1.1.0): API для облачных моделей
- **ultralytics** (>=8.0.0): YOLOv8 для локального обнаружения
- **Pillow** (>=10.0.0): Обработка изображений
- **numpy** (>=1.24.0): Численные операции
- **python-dotenv** (>=1.0.0): Управление переменными окружения

## Безопасность

- **Не публикуйте** ваш `.env` файл или API ключи
- `.env` добавлен в `.gitignore` для предотвращения случайных коммитов
- Для производства используйте переменные окружения вместо `.env` файла
- Локальный режим не отправляет данные в интернет

## Информация о модели

### API модель (Roboflow)
- **Workspace**: phone-in-hand-detection
- **Project**: phone-in-hand-detection
- **Version**: 19 (по умолчанию)
- **Тип**: YOLOv8
- **Классы**: Обнаружение телефона в руке

### Локальная модель (YOLOv8)
- **Архитектура**: YOLOv8 nano (yolov8n.pt)
- **Обучение**: На датасете phone-in-hand-detection v32
- **Размер входа**: 640x640 пикселей
- **Производительность**: Зависит от оборудования (GPU рекомендуется)

## Советы по использованию

1. **Для лучших результатов**:
   - Обеспечьте хорошее освещение
   - Держите камеру неподвижно
   - Располагайте телефон в пределах видимости камеры

2. **Оптимизация производительности**:
   - Используйте локальную модель для более быстрого вывода
   - Используйте GPU, если доступен
   - Уменьшите порог уверенности для большего количества обнаружений

3. **Сохранение результатов**:
   - Скриншоты сохраняются с временной меткой
   - Имя файла включает результат обнаружения и уверенность
   - Все сохраняется в папке `screenshots/`

---

**Версия**: 1.0  
**Последнее обновление**: 2024  
**Python**: 3.8+
